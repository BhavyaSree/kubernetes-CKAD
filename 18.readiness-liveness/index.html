<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Bhavya Sree Bindela">
        <link rel="canonical" href="https://bhavyasree.github.io/Kubernetes-CKAD/18.readiness-liveness/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Readiness-Liveliness - Kubernetes-CKAD</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/obsidian.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Kubernetes-CKAD</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Getting started</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../01.kubernetes-architecture/" class="dropdown-item">Architecture</a>
</li>
                                    
<li>
    <a href="../02.imperative-commands/" class="dropdown-item">Imperative Commands</a>
</li>
                                    
<li>
    <a href="../03.formatting-output-with-kubectl/" class="dropdown-item">Output Format</a>
</li>
                                    
<li>
    <a href="../04.questions-1/" class="dropdown-item">Examples</a>
</li>
                                    
<li>
    <a href="../05.configuration-commands/" class="dropdown-item">Commands</a>
</li>
                                    
<li>
    <a href="../06.edit-pods-deploys/" class="dropdown-item">Edit POD & Deploy</a>
</li>
                                    
<li>
    <a href="../07.configuration-env/" class="dropdown-item">Env variables</a>
</li>
                                    
<li>
    <a href="../08.configMaps/" class="dropdown-item">ConfigMap</a>
</li>
                                    
<li>
    <a href="../09.secrets/" class="dropdown-item">Secret</a>
</li>
                                    
<li>
    <a href="../10.security/" class="dropdown-item">Security</a>
</li>
                                    
<li>
    <a href="../11.kubernetes-security/" class="dropdown-item">K8-Security</a>
</li>
                                    
<li>
    <a href="../12.service-account/" class="dropdown-item">Service Account</a>
</li>
                                    
<li>
    <a href="../13.resource-requirements/" class="dropdown-item">Resources</a>
</li>
                                    
<li>
    <a href="../14.taints-tolerations/" class="dropdown-item">Taints & Tolerations</a>
</li>
                                    
<li>
    <a href="../15.node-selectors-affinity/" class="dropdown-item">NodeSelectors & Affinity</a>
</li>
                                    
<li>
    <a href="../16.taints%26tolerations-Vs-nodeaffinity/" class="dropdown-item">T&T/NodeAffinity</a>
</li>
                                    
<li>
    <a href="../17.multi-container-pods/" class="dropdown-item">MultiContainer pod</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Readiness-Liveliness</a>
</li>
                                    
<li>
    <a href="../19.container-logging/" class="dropdown-item">Logging</a>
</li>
                                    
<li>
    <a href="../20.monitoring/" class="dropdown-item">Monitoring</a>
</li>
                                    
<li>
    <a href="../21.labels-selectors-annotations/" class="dropdown-item">Selectors</a>
</li>
                                    
<li>
    <a href="../22.updates-rollbacks/" class="dropdown-item">Upgrades-Rollbacks</a>
</li>
                                    
<li>
    <a href="../23.jobs/" class="dropdown-item">Jobs</a>
</li>
                                    
<li>
    <a href="../24.services/" class="dropdown-item">Services</a>
</li>
                                    
<li>
    <a href="../25.Ingress/" class="dropdown-item">Ingress</a>
</li>
                                    
<li>
    <a href="../26.network-policies/" class="dropdown-item">Network Policy</a>
</li>
                                    
<li>
    <a href="../27.volumes/" class="dropdown-item">volumes</a>
</li>
                                    
<li>
    <a href="../28.refernce/" class="dropdown-item">Points</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Help <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../KodeKloud-Kubernetes%2B-CKAD.pdf" class="dropdown-item">Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../17.multi-container-pods/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../19.container-logging/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/BhavyaSree/kubernetes-CKAD/edit/master/docs/18.readiness-liveness.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#readiness-probes" class="nav-link">Readiness Probes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#liveness-probes" class="nav-link">Liveness Probes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="readiness-probes">Readiness Probes</h2>
<h3 id="pod-lifecycle">POD LifeCycle</h3>
<p>A POD has a POD status and conditions.   </p>
<ul>
<li>A POD status tells us where a POD is in its lifecycle.<br />
  When a POD is creating, it will be in a <code>pending</code> state, this is when the scheduler tries to figure out, where to place the POD.<br />
  If the scheduler cannot find a node to place the POD, it remains in the <code>pending</code> state.<br />
  To find out, why it's stuck in a pending state run <br />
<code>kubectl describe pod &lt;podname&gt;</code>  </li>
</ul>
<p>Once the POD is scheduled, it goes to <code>containerCreating</code> status, where are the images needed for the application are pulled and the container starts.   </p>
<p>Once all the containers in a POD starts, it goes into a <code>running</code> state.  It continues to be in <code>running</code> state until the program gets completed successfully or it is terminated.  </p>
<p>The status of the POD can be seen under <code>kubectl get pods</code>. The POD status only gives us the high level summary of the POD.  </p>
<ul>
<li>Conditions complement the POD status. <br />
  It is an array of True or False values, that tell us the state of a POD.<br />
  When a POD is scheduled on a node, the <code>POD scheduled</code> condition is set to <code>True</code> and when the POD is <code>initialised</code>, it's value is set to <code>True</code>. <br />
  When all the containers in the POD are ready, the <code>containersReady</code> is set to <code>True</code> and finally the POD itself is considered to be ready.<br />
  To see the status the POD conditions..<br />
<code>kubectl describe &lt;pod-name&gt;</code>  -- under conditions.<br />
  We also see the ready state of the POD in the output of <code>kubectl get pods</code>.  </li>
</ul>
<p>The <code>containersReady</code> or <code>Ready</code> condition indicates that the containers inside the pod are ready to accept the user traffic.</p>
<p>Normally servers takes some seconds to intialize the server and ready to serve the users. During this wait period, the pod continues to show that the container is ready to server. In this case, the status of the container is wrong.
By default, kubernetes assumes as soon as the container is created, it is ready to serve the user traffic.<br />
This makes users to hit a pod that is not yet running a live application.</p>
<p>We need a way to tie the ready condition to the actual state of the application inside the container.  </p>
<p>To check the application is ready or not, we can set up of different kinds of tests     </p>
<ul>
<li>In case of webservers - HTTP test - /api/ready</li>
<li>In case of database - TCP test - particular TCP socket is listening or not</li>
<li>customer script in the container that executes successfully when container is ready.</li>
</ul>
<p>In the above cases, only when the test gets passed, the container will be set to ready state. These tests can be configures in pod-definition file as below</p>
<p><img alt="HTTP-probe" src="../Screens/HTTP-probe.png" /></p>
<p>For a minimum of 10 seconds warmup we can add <code>initialDelaySeconds</code> option
To specify how often to probe, we can use  <code>periodSeconds</code> option
By default, if the application is not ready after 3 attemps the probe will stop.<br />
If we want to make more attempts use <code>failureThreshold</code> option.</p>
<p><img alt="probes" src="../Screens/probes.png" /></p>
<h2 id="liveness-probes">Liveness Probes</h2>
<p>When we run an image of nginx using docker, it starts to serve the users. For some reason, the web server crashes and nginx process exists. The container exists as well. <br />
Since, docker is not an orchestration engine, the container continues to stays to dead and denies services to users, until we manually create other nginx container.  </p>
<p>In kubernetes orchestation, when we run the same application with kubernetes, everytime the application crashes, kubernetes makes an attempt to restart the container to restore service to users. (if we observe, number of restarts in <code>kubectl get pods</code> command get increases)  </p>
<p>If the application is not working (because of coding issues) but the container continues stay alive i.e., container is up but the users hitting the container are not served. In this case, container needs to be restarted or destroyed and a new container needs to be brought up. Here comes the liveliness probe. </p>
<p>A liveliness probe can be configured on the container to periodically test whether the application within the container is actually healthy? If the test fails, the container is considered unhealthy and is destroyed and recreated.<br />
As a developer, we need to define what it means to a application to be healthy.  </p>
<ul>
<li>In case of a webapplication - when an api server is up and running.</li>
<li>In case of a database - a particular TCP socket is listening.</li>
<li>Simply execute a command to perform a test.</li>
</ul>
<p>Liveness probe is configured in the pod definitionfile as readiness probe</p>
<p><img alt="liveness" src="../Screens/liveness.png" /></p>
<p><img alt="liveness-probes" src="../Screens/liveness-probes.png" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 <a href="https://www.linkedin.com/in/bhavyabindela/">Bhavya Sree Bindela</a>.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
