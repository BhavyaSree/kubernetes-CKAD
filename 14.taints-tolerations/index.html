<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Bhavya Sree Bindela">
        <link rel="canonical" href="https://bhavyasree.github.io/Kubernetes-CKAD/14.taints-tolerations/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Taints & Tolerations - Kubernetes-CKAD</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/obsidian.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Kubernetes-CKAD</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Getting started</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../01.kubernetes-architecture/" class="dropdown-item">Architecture</a>
</li>
                                    
<li>
    <a href="../02.imperative-commands/" class="dropdown-item">Imperative Commands</a>
</li>
                                    
<li>
    <a href="../03.formatting-output-with-kubectl/" class="dropdown-item">Output Format</a>
</li>
                                    
<li>
    <a href="../04.questions-1/" class="dropdown-item">Examples</a>
</li>
                                    
<li>
    <a href="../05.configuration-commands/" class="dropdown-item">Commands</a>
</li>
                                    
<li>
    <a href="../06.edit-pods-deploys/" class="dropdown-item">Edit POD & Deploy</a>
</li>
                                    
<li>
    <a href="../07.configuration-env/" class="dropdown-item">Env variables</a>
</li>
                                    
<li>
    <a href="../08.configMaps/" class="dropdown-item">ConfigMap</a>
</li>
                                    
<li>
    <a href="../09.secrets/" class="dropdown-item">Secret</a>
</li>
                                    
<li>
    <a href="../10.security/" class="dropdown-item">Security</a>
</li>
                                    
<li>
    <a href="../11.kubernetes-security/" class="dropdown-item">K8-Security</a>
</li>
                                    
<li>
    <a href="../12.service-account/" class="dropdown-item">Service Account</a>
</li>
                                    
<li>
    <a href="../13.resource-requirements/" class="dropdown-item">Resources</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Taints & Tolerations</a>
</li>
                                    
<li>
    <a href="../15.node-selectors-affinity/" class="dropdown-item">NodeSelectors & Affinity</a>
</li>
                                    
<li>
    <a href="../16.taints%26tolerations-Vs-nodeaffinity/" class="dropdown-item">T&T/NodeAffinity</a>
</li>
                                    
<li>
    <a href="../17.multi-container-pods/" class="dropdown-item">MultiContainer pod</a>
</li>
                                    
<li>
    <a href="../18.readiness-liveness/" class="dropdown-item">Readiness-Liveliness</a>
</li>
                                    
<li>
    <a href="../19.container-logging/" class="dropdown-item">Logging</a>
</li>
                                    
<li>
    <a href="../20.monitoring/" class="dropdown-item">Monitoring</a>
</li>
                                    
<li>
    <a href="../21.labels-selectors-annotations/" class="dropdown-item">Selectors</a>
</li>
                                    
<li>
    <a href="../22.updates-rollbacks/" class="dropdown-item">Upgrades-Rollbacks</a>
</li>
                                    
<li>
    <a href="../23.jobs/" class="dropdown-item">Jobs</a>
</li>
                                    
<li>
    <a href="../24.services/" class="dropdown-item">Services</a>
</li>
                                    
<li>
    <a href="../25.Ingress/" class="dropdown-item">Ingress</a>
</li>
                                    
<li>
    <a href="../26.network-policies/" class="dropdown-item">Network Policy</a>
</li>
                                    
<li>
    <a href="../27.volumes/" class="dropdown-item">volumes</a>
</li>
                                    
<li>
    <a href="../28.refernce/" class="dropdown-item">Points</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Help <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../KodeKloud-Kubernetes%2B-CKAD.pdf" class="dropdown-item">Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../13.resource-requirements/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../15.node-selectors-affinity/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/BhavyaSree/kubernetes-CKAD/edit/master/docs/14.taints-tolerations.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#taints-node" class="nav-link">Taints - Node</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#tolerations-pods" class="nav-link">Tolerations - PODs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#master-node" class="nav-link">Master Node</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>Taints and tolerations have nothing to do with security or intrusion on the cluster.  </p>
<p><code>Taints</code> and <code>Tolerations</code> are used to set restrictions on what pods can be shared on that node.  </p>
<p>When the PODS are created, kubernetes scheduler tries to place these pods on the available worker nodes.<br />
As of now, there are no restrictions or limitations and so scheduler places the PODs across all of the nodes to balance them out equally.  </p>
<p>Let us assume, we have dedicated resources on node1 for a particular use case or application. so, we would like only those PODs that belong this application to be placed on node1.   </p>
<p>First, we prevent all PODs from placing on node1 by placing a taint on the node, lets say it as blue.<br />
By default, PODs won't have any tolerations i.e., unless specified otherwise none of the PODs can tolerate any taint. So, in this case none the PODs can be placed on node1 as none of them can tolerate the taint blue.  i.e., no unwanted PODs can be placed on node1.<br />
Now, we need to enable certain PODs to be placed on this node. For this, we must specify which PODs are tolerant for this particular taint. In our case, we would like to allow only POD D to be placed on this node. So, we add a toleration to POD D. POD D is now tolerant to blue. Now, when scheduler tries to place POD D on node1, it goes through. Node1 can only accept PODs that are tolerant to blue taint.  </p>
<p><img alt="Taints" src="../Screens/taints.png" /></p>
<p>!!! Note
    " Taints are set on nodes and Tolerations are set on PODs "</p>
<h2 id="taints-node">Taints - Node</h2>
<p><code>kubectl taint nodes node-name key=value:taint-effect</code>  <br />
To taint a node , specify the node name to taint followed by a taint itself which is a key value pair. <br />
taint-effect defines what would happen to the PODs if they do not tolerate the taint.   </p>
<p>There are three taint effects.<br />
* NoSchedule -- PODs will not be scheduled on the node.
* PreferNoSchedule -- The system will try to avoid placing a POD on the node but    that is not guaranteed. 
* NoExecute -- The new PODs will not be scheduled on the node and the existing pods on the nodes will be evicted if they do not tolerate the taint. These PODs may have been scheduled on the node before taint was applied on the node.   </p>
<p><code>kubectl taint nodes node1 app=blue:NoSchedule</code>   </p>
<h2 id="tolerations-pods">Tolerations - PODs</h2>
<p>To add a toleration to the POD, pull up the pod-definition file, under spec section, add tolerations section and in this section move all the values thats specified while placing taint on the node.  </p>
<p><code>kubectl taint nodes node1 app=blue:NoSchedule</code>   </p>
<p><code>pod-definition file</code></p>
<pre><code class="yaml">apiVersion: v1
kind: Pod
metadata: 
  name: myapp-pod
spec:
  containers:
   - name: nginx-container
      image: nginx
  tolerations:
    - key: &quot;app&quot;
      operator: &quot;Equal&quot;
      value: &quot;blue&quot;
      effect: &quot;NoSchedule&quot;
</code></pre>

<p>When the PODs are now created or update with new tolerations, they are either not scheduled on node1 or evicted from the existing node, depending on the effect set.  </p>
<p>Taints and Tolerations are only meant to retsrict nodes from accepting certain PODs. It does not gurantee that the POD with the toleration will be kept only placed on the node with taint. Since there won't be any taints on other nodes, the POD with toleration can very well be placed on other nodes.</p>
<p><img alt="accept" src="../Screens/accept.png" />  </p>
<p>!!! Note
    " Taints and Tolerations does not tell the POD to go to a particular node. Instead, it tells the node to only accept PODs with certain Tolerations."</p>
<h2 id="master-node">Master Node</h2>
<p>The scheduler does not schedule any PODs on the master node. <br />
When the kubernetes cluster is first set up, a taint is set up on the master node automatically that prevents any PODs from being scheduled on this node.<br />
We can modify this if required. However, the best practice is to not deploy application workloads on master server.  </p>
<p>To view the taints on the master node <br />
<code>kubectl describe node &lt;nodename&gt; | grep Taint</code>  </p>
<p><img alt="master" src="../Screens/master.png" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 <a href="https://www.linkedin.com/in/bhavyabindela/">Bhavya Sree Bindela</a>.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
