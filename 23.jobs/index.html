<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Bhavya Sree Bindela">
        <link rel="canonical" href="https://bhavyasree.github.io/Kubernetes-CKAD/23.jobs/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Jobs - Kubernetes-CKAD</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/obsidian.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Kubernetes-CKAD</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Getting started</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../01.kubernetes-architecture/" class="dropdown-item">Architecture</a>
</li>
                                    
<li>
    <a href="../02.imperative-commands/" class="dropdown-item">Imperative Commands</a>
</li>
                                    
<li>
    <a href="../03.formatting-output-with-kubectl/" class="dropdown-item">Output Format</a>
</li>
                                    
<li>
    <a href="../04.questions-1/" class="dropdown-item">Examples</a>
</li>
                                    
<li>
    <a href="../05.configuration-commands/" class="dropdown-item">Commands</a>
</li>
                                    
<li>
    <a href="../06.edit-pods-deploys/" class="dropdown-item">Edit POD & Deploy</a>
</li>
                                    
<li>
    <a href="../07.configuration-env/" class="dropdown-item">Env variables</a>
</li>
                                    
<li>
    <a href="../08.configMaps/" class="dropdown-item">ConfigMap</a>
</li>
                                    
<li>
    <a href="../09.secrets/" class="dropdown-item">Secret</a>
</li>
                                    
<li>
    <a href="../10.security/" class="dropdown-item">Security</a>
</li>
                                    
<li>
    <a href="../11.kubernetes-security/" class="dropdown-item">K8-Security</a>
</li>
                                    
<li>
    <a href="../12.service-account/" class="dropdown-item">Service Account</a>
</li>
                                    
<li>
    <a href="../13.resource-requirements/" class="dropdown-item">Resources</a>
</li>
                                    
<li>
    <a href="../14.taints-tolerations/" class="dropdown-item">Taints & Tolerations</a>
</li>
                                    
<li>
    <a href="../15.node-selectors-affinity/" class="dropdown-item">NodeSelectors & Affinity</a>
</li>
                                    
<li>
    <a href="../16.taints%26tolerations-Vs-nodeaffinity/" class="dropdown-item">T&T/NodeAffinity</a>
</li>
                                    
<li>
    <a href="../17.multi-container-pods/" class="dropdown-item">MultiContainer pod</a>
</li>
                                    
<li>
    <a href="../18.readiness-liveness/" class="dropdown-item">Readiness-Liveliness</a>
</li>
                                    
<li>
    <a href="../19.container-logging/" class="dropdown-item">Logging</a>
</li>
                                    
<li>
    <a href="../20.monitoring/" class="dropdown-item">Monitoring</a>
</li>
                                    
<li>
    <a href="../21.labels-selectors-annotations/" class="dropdown-item">Selectors</a>
</li>
                                    
<li>
    <a href="../22.updates-rollbacks/" class="dropdown-item">Upgrades-Rollbacks</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Jobs</a>
</li>
                                    
<li>
    <a href="../24.services/" class="dropdown-item">Services</a>
</li>
                                    
<li>
    <a href="../25.Ingress/" class="dropdown-item">Ingress</a>
</li>
                                    
<li>
    <a href="../26.network-policies/" class="dropdown-item">Network Policy</a>
</li>
                                    
<li>
    <a href="../27.volumes/" class="dropdown-item">volumes</a>
</li>
                                    
<li>
    <a href="../28.refernce/" class="dropdown-item">Points</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Help <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../KodeKloud-Kubernetes%2B-CKAD.pdf" class="dropdown-item">Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../22.updates-rollbacks/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../24.services/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/BhavyaSree/kubernetes-CKAD/edit/master/docs/23.jobs.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            
            <li class="nav-item" data-level="2"><a href="#cronjobs" class="nav-link">CronJobs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>There are different types of workloads that a container can serve.<br />
Workloads such as web servers continue to run for a long period of time, until manually taken down.
There are other kinds of workloads such as batch processing, analytics or reporting, that are meant to carryout specific tasks and finish.<br />
Example: Performing a computation, processing an image, performing an analytic task, sending an email etc,. These are meant for short period of time.</p>
<p>Let us first see how these workloads work in docker.<br />
In Docker,<br />
<code>docker run ubuntu expr 3+2</code> (performs a simple math operation)<br />
In this case, docker container comes up, perform the simple operation, prints the output and then exists.<br />
when we run <code>docker ps -a</code> command, we see the container in exit state.  </p>
<p>In Kubernetes,<br />
<img alt="expr" src="../Screens/expr.png" /></p>
<p>Though the container computes output and exits, kubernetes continues to restart the container and bring it up again. This continues to happen until a threshold is reached. </p>
<p>Kubernetes wants our applications to live forever. The default behaviour of pods is to attempt to restart the container to keep it running.<br />
This behaviour is defined by the property <code>restartPolicy</code> set on the pod which is by default set to always. Therefore, the pod always recreates the container when it exits. We can overwrite this behaviour by setting this property to <code>Never</code> or <code>Onfailure</code>. Thus, the kubernetes does not restart the container once the job is finished.</p>
<p><code>pod-definition file</code>  </p>
<pre><code class="yaml">apiVersion: v1
kind: Pod
metadata: 
  name: math-pod
spec:
  containers: 
    - name: math-add
      image: ubuntu
      command: ['expr', '3', '+', '2']

  restartPolicy: Never
</code></pre>

<p>While <code>replicaset</code> is used to make sure a specified number of pods are running at all time, a <code>job</code> is used to run a set of pods to perform a given task to completion.  </p>
<p>We create a job using a definition file. </p>
<p><code>job-definition file</code></p>
<pre><code class="yaml">apiVersion: batch/v1
kind: Job
metadata:
  name: math-add-job
spec:
  template:
  # pod-definition specification
    spec:
      containers:
        - name: math-add
          image: ubuntu
          command: ['expr', '2', '+', '3']
      restartPolicy: Never
</code></pre>

<p>To create a job
<code>kubectl create -f job-definition.yaml</code>   </p>
<p>To view the jobs<br />
<code>kubectl get jobs</code>  </p>
<p>The standard ouput of the container can be seen in container logs<br />
<code>kubectl logs &lt;podname&gt;</code>   </p>
<p>To delete the job<br />
<code>kubectl delete job &lt;jobname&gt;</code>  </p>
<p><img alt="job" src="../Screens/job.png" /></p>
<h3 id="job-with-multiple-pods">Job with multiple pods</h3>
<p>To run multiple pods we set a value for <code>completions</code> under the job specification.</p>
<p><img alt="multiple-pods" src="../Screens/multiple-pods.png" /></p>
<p>By default, the pods are created one after the other. The second pod is created only after the first is finished.  </p>
<p>If the pod fails, the job tries to create new pods until it has three successful completions, and that completes the job.</p>
<p><img alt="failed" src="../Screens/failed.png" /></p>
<p>Instead of getting the pods created sequentially, we can get them created in parallel. For this add the property called <code>parallelism</code> to the job specification.
We set it to 3, to create 3 pods in parallel.</p>
<p><img alt="parallel" src="../Screens/parallel.png" /></p>
<p>The job first creates 3 pods at once, two of which completes successfully. Now, we only need one more, it is intelligent enough to create one pod at a time, until we get a total 3 successful pods.</p>
<h2 id="cronjobs">CronJobs</h2>
<p>A CronJob is a job that can be scheduled. We can schedule and run a CronJob Periodically. 
Example: A job to generate a report and send an email.  </p>
<p><code>cronjob-definition file</code></p>
<pre><code class="yaml">apiVersion: batch/v1beta1
kind: CronJob
metadata: 
  name: reporting-cron-job
spec:
  # schedule option takes cron like format string, where it takes the time when the job is to be run
  schedule: &quot;*/1 * * * *&quot;
  jobTemplate:
    # Job spec
    spec: 
      completions: 3
      parallelism: 3
      template:
        spec:
          containers: 
            - name: reporting-tool
              image: reporting-tool
          restartPolicy: Never
</code></pre>

<p><img alt="schedule" src="../Screens/schedule.png" /></p>
<p>To create cronjob<br />
<code>kubectl create -f &lt;cronjob-definition-file&gt;</code>  </p>
<p>To view the available cronjobs
<code>kubectl get cronjob</code>  </p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 <a href="https://www.linkedin.com/in/bhavyabindela/">Bhavya Sree Bindela</a>.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
